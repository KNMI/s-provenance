from pymongo import *
import json


class ProvenanceStore(object):

	def __init__(self, url):
 
		self.conection = MongoClient(host=url)
		self.db = self.conection["verce-prov"]
		self.collection = self.db['lineage']

 		
	def getRun(self, id):
		obj = self.collection.find({'runId':id}).sort("creationDate")
		output = list()
		
		for x in obj:
			output.append(x)
		
		return json.dumps(output)
	
	def getTrace(self, id, list):
		 
		xx = self.collection.find_one({"streams._id":id},{"derivationIds":1,"streams":1});
		print json.dumps(xx)
		list.append(xx)
		for derid in xx["derivationIds"]:
			
	 		self.getTrace(derid["DerivedFromDatasetID"],list)
		
		return json.dumps(list)